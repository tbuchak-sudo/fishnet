<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FishNet</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4267b2">
    <link rel="apple-touch-icon" href="icon.png"> 

    <style>
        :root {
            --bg-body: #e9ebee; --bg-card: #ffffff; --text-main: #1c1e21; --text-sec: #65676b;
            --input-bg: #f0f2f5; --border: #ddd; --header-bg: #4267b2; --accent: #4267b2;
            --fab-bg: #4267b2; --fab-color: white; --shadow: rgba(0,0,0,0.1);
        }
        body.dark-mode {
            --bg-body: #18191a; --bg-card: #242526; --text-main: #e4e6eb; --text-sec: #b0b3b8;
            --input-bg: #3a3b3c; --border: #3e4042; --header-bg: #242526; --accent: #4599ff;
            --fab-bg: #4599ff; --fab-color: #18191a; --shadow: rgba(0,0,0,0.5);
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 0 auto; background-color: var(--bg-body); color: var(--text-main); padding-bottom: 80px; transition: 0.3s; }
        
        /* HEADER */
        header { 
            background: var(--header-bg); color: #fff; padding: 12px 16px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .logo { font-weight: 800; font-size: 22px; letter-spacing: -0.5px; cursor: pointer; }
        .nav-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-left: 15px;}

        /* VIEWS */
        .view { display: none; }
        .view.active { display: block; }

        /* PROFILE STYLES */
        .profile-header {
            background: var(--bg-card); padding: 0 0 20px 0; border-radius: 0 0 12px 12px;
            text-align: center; margin-bottom: 20px; box-shadow: 0 1px 3px var(--shadow);
        }
        .cover-photo {
            height: 140px; background: linear-gradient(135deg, var(--accent), #00c6ff);
            border-radius: 0 0 0 0; position: relative;
        }
        .profile-avatar {
            width: 110px; height: 110px; border-radius: 50%; object-fit: cover;
            border: 4px solid var(--bg-card); margin-top: -55px; background: white; position: relative; z-index: 10;
        }
        .profile-name { font-size: 22px; font-weight: 800; margin-top: 10px; }
        .profile-bio { color: var(--text-sec); font-size: 15px; margin: 5px 20px 15px 20px; font-style: italic; }
        
        /* INFO TABLE (–ê–ù–ö–ï–¢–ê) */
        .profile-info {
            text-align: left; padding: 0 20px; margin-top: 20px; 
            border-top: 1px solid var(--border); padding-top: 15px;
        }
        .info-row { display: flex; margin-bottom: 10px; font-size: 14px; }
        .info-label { width: 120px; color: var(--text-sec); font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .info-val { color: var(--text-main); font-weight: 500; flex: 1; }

        .profile-stats { display: flex; justify-content: center; gap: 30px; margin: 15px 0; font-size: 14px; color: var(--text-sec); }
        .stat-val { font-weight: 800; color: var(--text-main); display: block; font-size: 18px; }

        .btn-primary { background: var(--accent); color: white; border: none; padding: 10px 25px; border-radius: 20px; font-weight: 600; cursor: pointer; width: 80%; transition: 0.2s;}
        .btn-primary:hover { opacity: 0.9; }
        .btn-secondary { background: var(--input-bg); color: var(--text-main); border: none; padding: 8px 20px; border-radius: 20px; font-weight: 600; cursor: pointer; }

        /* EDIT FORM STYLES */
        .edit-group { margin-bottom: 15px; }
        .edit-label { display: block; font-size: 12px; color: var(--text-sec); margin-bottom: 5px; font-weight: bold; }
        .edit-input, .edit-select, .edit-textarea { 
            width: 100%; padding: 10px; border: 1px solid var(--border); 
            background: var(--input-bg); color: var(--text-main); border-radius: 8px; box-sizing: border-box; 
            font-family: inherit;
        }
        .edit-textarea { resize: vertical; min-height: 60px; }

        /* STANDARD STYLES */
        .search-box { position: sticky; top: 58px; z-index: 90; background: var(--bg-body); padding: 10px 10px 0 10px; }
        .search-input { width: 100%; padding: 12px 20px; border-radius: 25px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); outline: none; box-sizing: border-box; }
        
        .post { background: var(--bg-card); padding: 16px; margin-bottom: 16px; border-radius: 12px; box-shadow: 0 1px 2px var(--border); margin-top: 10px;}
        .post-header { display: flex; align-items: center; margin-bottom: 12px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; object-fit: cover; cursor: pointer; }
        .author-name { font-weight: 700; color: var(--text-main); font-size: 15px; cursor: pointer; }
        .post-image { width: 100%; border-radius: 8px; margin-bottom: 12px; border: 1px solid var(--border); }
        .actions { border-top: 1px solid var(--border); padding-top: 12px; display: flex; gap: 20px; }
        .action-btn { background: none; border: none; color: var(--text-sec); cursor: pointer; display: flex; align-items: center; gap: 5px;}
        .like-active { color: #e0245e; }

        .fab { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: var(--fab-bg); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .fab.hidden { display: none; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: flex-end; }
        .modal-overlay.open { display: flex; }
        #post-form { width: 100%; background: var(--bg-card); padding: 20px; border-radius: 16px 16px 0 0; max-width: 600px; margin: 0 auto; }
        
        /* Edit modal needs to be scrollable if content is long */
        #edit-modal-content { 
            width: 100%; background: var(--bg-card); padding: 20px; border-radius: 16px 16px 0 0; 
            max-width: 600px; margin: 0 auto; max-height: 90vh; overflow-y: auto; 
        }

        .delete-btn { margin-left: auto; color: var(--text-sec); cursor: pointer; }
        #loginBtn { background: white; color: var(--header-bg); border: none; padding: 6px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        
        .tab-btn { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-sec); padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 13px; }
        .tab-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="goHome()">FishNet üêü</div>
        <div style="display:flex; align-items:center;">
            <button id="themeBtn" style="background:none; border:none; font-size:20px; cursor:pointer;">üåô</button>
            <button class="nav-btn" onclick="goToMyProfile()">üë§</button>
            <button id="loginBtn" style="margin-left:10px;">–í—Ö—ñ–¥</button>
        </div>
    </header>

    <div id="view-home" class="view active">
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="üîç –ü–æ—à—É–∫...">
        </div>
        <div style="display:flex; justify-content:center; gap:10px; margin-top:10px;">
            <button class="tab-btn active" onclick="filterFeed('all')">üåê –í—Å—ñ</button>
            <button class="tab-btn" onclick="filterFeed('friends')">üë• –î—Ä—É–∑—ñ</button>
        </div>
        <div id="feed" style="padding:10px;"></div>
        <div id="fab" class="fab hidden" onclick="toggleModal('post-modal', true)">+</div>
    </div>

    <div id="view-profile" class="view">
        <div class="profile-header">
            <div class="cover-photo"></div>
            <img id="p-avatar" src="" class="profile-avatar">
            <div id="p-name" class="profile-name">Name</div>
            <div id="p-bio" class="profile-bio">Status</div>
            
            <div class="profile-stats">
                <div><span class="stat-val" id="p-followers">0</span>–ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤</div>
                <div><span class="stat-val" id="p-following">0</span>–ü—ñ–¥–ø–∏—Å–æ–∫</div>
            </div>

            <button id="p-action-btn" class="btn-primary">–î—ñ—è</button>

            <div class="profile-info">
                <div class="info-row">
                    <div class="info-label">üìç –õ–æ–∫–∞—Ü—ñ—è</div>
                    <div class="info-val" id="p-location">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">üé£ –°—Ç–∏–ª—å</div>
                    <div class="info-val" id="p-style">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">üõ∂ –°–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è</div>
                    <div class="info-val" id="p-gear">-</div>
                </div>
                <div class="info-row">
                    <div class="info-label">üó∫Ô∏è –ú—ñ—Å—Ü—è</div>
                    <div class="info-val" id="p-spots">-</div>
                </div>
            </div>
        </div>
        
        <h3 style="padding:0 20px; margin:0; border-bottom: 1px solid var(--border); padding-bottom:10px;">–°—Ç—ñ–Ω–∞</h3>
        <div id="profile-feed" style="padding:10px;"></div>
    </div>

    <div id="post-modal" class="modal-overlay" onclick="toggleModal('post-modal', false)">
        <div id="post-form" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h3 style="margin:0">–ù–æ–≤–∏–π –ø–æ—Å—Ç</h3>
                <span onclick="toggleModal('post-modal', false)" style="cursor:pointer; font-size:20px;">√ó</span>
            </div>
            <textarea id="message" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; box-sizing:border-box;" placeholder="–©–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
            <label style="cursor:pointer; display:block; margin:10px 0; color:var(--accent);">üì∑ –§–æ—Ç–æ <input type="file" id="imageInput" hidden></label>
            <button onclick="publishPost()" class="btn-primary" style="width:100%">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="edit-modal" class="modal-overlay" onclick="toggleModal('edit-modal', false)">
        <div id="edit-modal-content" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h3 style="margin:0">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h3>
                <span onclick="toggleModal('edit-modal', false)" style="cursor:pointer; font-size:20px;">√ó</span>
            </div>

            <div class="edit-group">
                <label class="edit-label">–Ü–º'—è (–ù—ñ–∫–Ω–µ–π–º)</label>
                <input id="edit-name" class="edit-input" placeholder="–Ø–∫ –≤–∞—Å –∑–≤–∞—Ç–∏?">
            </div>

            <div class="edit-group">
                <label class="edit-label">–°—Ç–∞—Ç—É—Å (Bio)</label>
                <input id="edit-bio" class="edit-input" placeholder="–ö–æ—Ä–æ—Ç–∫–∞ —Ñ—Ä–∞–∑–∞ –ø—Ä–æ –≤–∞—Å">
            </div>

            <div class="edit-group">
                <label class="edit-label">üìç –ú—ñ—Å—Ç–æ / –û–±–ª–∞—Å—Ç—å</label>
                <input id="edit-location" class="edit-input" placeholder="–ó–≤—ñ–¥–∫–∏ –≤–∏?">
            </div>

            <div class="edit-group">
                <label class="edit-label">üé£ –£–ª—é–±–ª–µ–Ω–∏–π –≤–∏–¥ –ª–æ–≤–ª—ñ</label>
                <select id="edit-style" class="edit-select">
                    <option value="">–ù–µ –≤–∏–±—Ä–∞–Ω–æ</option>
                    <option value="–°–ø—ñ–Ω—ñ–Ω–≥">–°–ø—ñ–Ω—ñ–Ω–≥</option>
                    <option value="–§—ñ–¥–µ—Ä">–§—ñ–¥–µ—Ä</option>
                    <option value="–ü–æ–ø–ª–∞–≤–æ–∫">–ü–æ–ø–ª–∞–≤–æ–∫</option>
                    <option value="–ö–∞—Ä–ø—Ñ—ñ—à–∏–Ω–≥">–ö–∞—Ä–ø—Ñ—ñ—à–∏–Ω–≥</option>
                    <option value="–ù–∞—Ö–ª–∏—Å—Ç">–ù–∞—Ö–ª–∏—Å—Ç</option>
                    <option value="–ó–∏–º–æ–≤–∞ —Ä–∏–±–∞–ª–∫–∞">–ó–∏–º–æ–≤–∞ —Ä–∏–±–∞–ª–∫–∞</option>
                    <option value="–¢—Ä–æ–ª—ñ–Ω–≥">–¢—Ä–æ–ª—ñ–Ω–≥</option>
                    <option value="–í—Å–µ –ø—ñ–¥—Ä—è–¥">–í—Å–µ –ø—ñ–¥—Ä—è–¥</option>
                </select>
            </div>

            <div class="edit-group">
                <label class="edit-label">üõ∂ –°–Ω–∞—Å—Ç—ñ / –ß–æ–≤–µ–Ω / –ú–æ—Ç–æ—Ä</label>
                <textarea id="edit-gear" class="edit-textarea" placeholder="–ß–∏–º –ª–æ–≤–∏—Ç–µ? (Shimano, —á–æ–≤–µ–Ω Kolibri...)"></textarea>
            </div>

            <div class="edit-group">
                <label class="edit-label">üó∫Ô∏è –£–ª—é–±–ª–µ–Ω—ñ –º—ñ—Å—Ü—è (–†—ñ—á–∫–∏, –û–∑–µ—Ä–∞)</label>
                <textarea id="edit-spots" class="edit-textarea" placeholder="–î–µ –ª—é–±–∏—Ç–µ –±—É–≤–∞—Ç–∏?"></textarea>
            </div>

            <div class="edit-group">
                <label class="edit-label">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–æ—Ç–æ (URL)</label>
                <input id="edit-photo" class="edit-input" placeholder="https://...">
            </div>

            <button onclick="saveProfile()" class="btn-primary" style="width:100%">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, deleteDoc, doc, updateDoc, arrayUnion, arrayRemove, getDoc, setDoc, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCN7xN8AZXXCxwf9GmuILYi5AcKAUYJVB4",
            authDomain: "fishnet-cb1ad.firebaseapp.com",
            projectId: "fishnet-cb1ad",
            messagingSenderId: "672721719482",
            appId: "1:672721719482:web:9b0ce0e3e41893fcccb283"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        let currentUser = null;
        let myFollowing = [];
        let allPosts = [];
        let viewingUid = null;

        // --- NAVIGATION ---
        window.goHome = () => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-home').classList.add('active');
            renderFeed(allPosts);
        };

        window.goToProfile = async (uid) => {
            viewingUid = uid;
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-profile').classList.add('active');
            loadProfileData(uid);
        };

        window.goToMyProfile = () => {
            if(currentUser) window.goToProfile(currentUser.uid);
            else alert("–£–≤—ñ–π–¥—ñ—Ç—å —Å–ø–æ—á–∞—Ç–∫—É!");
        };

        // --- AUTH ---
        document.getElementById('loginBtn').onclick = () => currentUser ? signOut(auth) : signInWithPopup(auth, new GoogleAuthProvider());

        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('loginBtn').innerText = "–í–∏–π—Ç–∏";
                document.getElementById('fab').classList.remove('hidden');
                
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                if (!snap.exists()) {
                    await setDoc(userRef, { 
                        name: user.displayName, photo: user.photoURL, email: user.email, following: [], bio: "–†–∏–±–∞–ª–∫–∞",
                        location: "", style: "", gear: "", spots: ""
                    });
                }
                myFollowing = snap.exists() ? (snap.data().following || []) : [];
            } else {
                document.getElementById('loginBtn').innerText = "–í—Ö—ñ–¥";
                document.getElementById('fab').classList.add('hidden');
                goHome();
            }
            renderFeed(allPosts);
        });

        // --- LOAD PROFILE ---
        async function loadProfileData(uid) {
            const userSnap = await getDoc(doc(db, "users", uid));
            const data = userSnap.exists() ? userSnap.data() : {};

            // Basic Info
            document.getElementById('p-name').textContent = data.name || "–ê–Ω–æ–Ω—ñ–º";
            document.getElementById('p-bio').textContent = data.bio || "–ë–µ–∑ —Å—Ç–∞—Ç—É—Å—É";
            document.getElementById('p-avatar').src = data.photo || "https://ui-avatars.com/api/?name=" + (data.name || "A");
            
            // Stats
            document.getElementById('p-following').textContent = (data.following || []).length;
            
            // Extended Info (–ê–Ω–∫–µ—Ç–∞)
            document.getElementById('p-location').textContent = data.location || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ";
            document.getElementById('p-style').textContent = data.style || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ";
            document.getElementById('p-gear').textContent = data.gear || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ";
            document.getElementById('p-spots').textContent = data.spots || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ";

            // Action Button
            const btn = document.getElementById('p-action-btn');
            if (currentUser && currentUser.uid === uid) {
                btn.textContent = "‚öôÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏";
                btn.className = "btn-secondary";
                btn.onclick = () => openEditModal(data);
            } else if (currentUser) {
                const isFollowing = myFollowing.includes(uid);
                btn.textContent = isFollowing ? "–í—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è" : "–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è";
                btn.className = isFollowing ? "btn-secondary" : "btn-primary";
                btn.onclick = () => toggleFollow(uid);
            } else {
                btn.style.display = 'none';
            }

            // Wall Posts
            const wallPosts = allPosts.filter(p => p.uid === uid);
            const wallContainer = document.getElementById('profile-feed');
            wallContainer.innerHTML = '';
            wallPosts.forEach(post => wallContainer.appendChild(createPostElement(post)));
        }

        // --- EDIT PROFILE LOGIC ---
        function openEditModal(data) {
            document.getElementById('edit-name').value = data.name || "";
            document.getElementById('edit-bio').value = data.bio || "";
            document.getElementById('edit-location').value = data.location || "";
            document.getElementById('edit-style').value = data.style || "";
            document.getElementById('edit-gear').value = data.gear || "";
            document.getElementById('edit-spots').value = data.spots || "";
            document.getElementById('edit-photo').value = data.photo || "";
            window.toggleModal('edit-modal', true);
        }

        window.saveProfile = async () => {
            const updates = {
                name: document.getElementById('edit-name').value,
                bio: document.getElementById('edit-bio').value,
                location: document.getElementById('edit-location').value,
                style: document.getElementById('edit-style').value,
                gear: document.getElementById('edit-gear').value,
                spots: document.getElementById('edit-spots').value,
                photo: document.getElementById('edit-photo').value
            };
            
            await updateDoc(doc(db, "users", currentUser.uid), updates);
            window.toggleModal('edit-modal', false);
            loadProfileData(currentUser.uid);
        };

        // --- DATA STREAM ---
        onSnapshot(query(collection(db, "posts"), orderBy("timestamp", "desc")), (snapshot) => {
            allPosts = [];
            snapshot.forEach(doc => allPosts.push({ id: doc.id, ...doc.data() }));
            
            if(document.getElementById('view-home').classList.contains('active')) {
                renderFeed(allPosts);
            } else if (viewingUid) {
                loadProfileData(viewingUid);
            }
        });

        // --- HELPERS ---
        function createPostElement(post) {
            const isLiked = currentUser && (post.likes || []).includes(currentUser.uid);
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
                <div class="post-header">
                    <img src="${post.photo || 'https://ui-avatars.com/api/?name='+post.author}" class="avatar" onclick="goToProfile('${post.uid}')">
                    <div style="flex:1;">
                        <div class="author-name" onclick="goToProfile('${post.uid}')">${post.author}</div>
                        <div style="font-size:12px; color:#aaa;">${post.timestamp ? new Date(post.timestamp.toDate()).toLocaleDateString() : '...'}</div>
                    </div>
                </div>
                ${post.text ? `<div class="post-text">${post.text}</div>` : ''}
                ${post.imageUrl ? `<img src="${post.imageUrl}" class="post-image" onclick="window.open('${post.imageUrl}')">` : ''}
                <div class="actions">
                    <button class="action-btn ${isLiked ? 'like-active' : ''}" onclick="toggleLike('${post.id}', ${isLiked})">
                        ${isLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${post.likes ? post.likes.length : 0}
                    </button>
                    ${currentUser && post.uid === currentUser.uid ? `<div style="margin-left:auto; color:#999; cursor:pointer;" onclick="deletePost('${post.id}')">√ó</div>` : ''}
                </div>
            `;
            return div;
        }

        function renderFeed(posts) {
            const container = document.getElementById('feed');
            container.innerHTML = '';
            posts.forEach(p => container.appendChild(createPostElement(p)));
        }

        window.toggleModal = (id, show) => { document.getElementById(id).classList.toggle('open', show); };

        window.publishPost = async () => {
            const text = document.getElementById('message').value;
            const file = document.getElementById('imageInput').files[0];
            if(!text && !file) return;
            
            let imageUrl = null;
            if(file) {
                 const reader = new FileReader();
                 reader.readAsDataURL(file);
                 await new Promise(r => reader.onload = r);
                 imageUrl = reader.result; 
            }

            await addDoc(collection(db, "posts"), {
                text: text, imageUrl: imageUrl, timestamp: serverTimestamp(),
                uid: currentUser.uid, author: currentUser.displayName, photo: currentUser.photoURL, likes: []
            });
            window.toggleModal('post-modal', false);
            document.getElementById('message').value = '';
        };
        
        if(localStorage.getItem('theme')==='dark') document.body.classList.add('dark-mode');
        document.getElementById('themeBtn').onclick = () => {
             document.body.classList.toggle('dark-mode');
             localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light');
        };

        window.toggleFollow = async (uid) => {
            const ref = doc(db, "users", currentUser.uid);
            if(myFollowing.includes(uid)) {
                await updateDoc(ref, { following: arrayRemove(uid) });
                myFollowing = myFollowing.filter(id => id !== uid);
            } else {
                await updateDoc(ref, { following: arrayUnion(uid) });
                myFollowing.push(uid);
            }
            loadProfileData(uid);
        };

        window.toggleLike = (id, isLiked) => {
            if (!currentUser) return;
            const ref = doc(db, "posts", id);
            updateDoc(ref, { likes: isLiked ? arrayRemove(currentUser.uid) : arrayUnion(currentUser.uid) });
        };
        
        document.getElementById('searchInput').oninput = (e) => {
            const term = e.target.value.toLowerCase();
            renderFeed(allPosts.filter(p => p.text?.toLowerCase().includes(term) || p.author.toLowerCase().includes(term)));
        };

        window.filterFeed = (type) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            if(type === 'all') renderFeed(allPosts);
            if(type === 'friends') renderFeed(allPosts.filter(p => myFollowing.includes(p.uid) || p.uid === currentUser.uid));
        };
        
        window.deletePost = (id) => confirm("–í–∏–¥–∞–ª–∏—Ç–∏?") && deleteDoc(doc(db, "posts", id));
    </script>
</body>
</html>
